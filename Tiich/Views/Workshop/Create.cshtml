@model TiichDAL.Workshop

@{
    ViewBag.Title = "Proposer";
    string x = TempData["UserID"].ToString();

    bool edit = false;
    
    if(Model.ID == 0)
    {
        edit = true;
    }
    else if(Model.UserID.ToString().Equals(x))
    {
        edit = true;
    }
    
    if(!edit && x != null)
    {
        TiichService.Service.WorkshopService service = new TiichService.Service.WorkshopService();
        service.AddVisitorToWorkshop(TempData["UserID"].ToString(), Model.ID);
    }
}

@using (Html.BeginForm("Create", "Workshop", FormMethod.Post))
{
    if(edit)
    {
        @Html.HiddenFor(m => m.CreationDate)
        @Html.HiddenFor(m => m.User)
        @Html.HiddenFor(m => m.UserID)
    }
    @Html.HiddenFor(i => i.Location)
    <div class="col-lg-10 col-lg-offset-1">
        <div class="well">
            <h1 >
                @{
                    if(edit)
                    {
                        @Html.TextBox("Label", Model.Label, new { @class = "form-control", @placeholder = "Votre titre ici" })
                    }
                    else
                    {
                        @Model.Label
                    }   
                }
            </h1>
        </div>
    </div>
    <!-- Content-->
    <div class="col-lg-10 col-lg-offset-1">
    <div class="col-lg-8">
        <div class="well col-lg-12" style="height:100%;">
            <div class="col-lg-6">
                <div>
                    @if(edit)
                    {
                        <p class="list-group-item">Date : @Html.TextBoxFor(model => model.Date, new { type = "date", @class = "form-control", @value = DateTime.Now.ToShortDateString() })</p>
                        <p class="list-group-item">Heure : @Html.TextBoxFor(i => i.Hour, new { type="time",  @class = "form-control", @placeholder = DateTime.Now.AddHours(1).ToShortTimeString() })</p>
                    }
                    else
                    {
                        <p class="list-group-item">Date : @DateTime.Now.ToShortDateString()</p>
                        <p class="list-group-item">Heure : @DateTime.Now.AddHours(1).ToShortTimeString()</p>
                    }
                    </div>
            </div>
            <div class="col-lg-6">
                @if(edit)
                {
                    @Html.TextBox("address", Model.Address, new { @placeholder = "Nowhere" })
                }
                else
                {
                    @Html.TextBox("address", Model.Address, new { @placeholder = @Model.Address, @class = "disabled"})
                }

                <div id="map">
                </div>
            </div>
        </div>

        <div class="col-lg-5 well">
            <h3>Détails</h3>
            <p>
               @if(edit)
               {
                     @Html.TextArea("details", Model.Details, new { @class = "form-control" })
               }
               else
               {
                   @Model.Details
               }   
            </p>
        </div>

        <div class="col-lg-6 col-lg-offset-1 well">
            <h3>A prévoir</h3>
            <p>
                @if(edit)
                {
                 @Html.TextArea("equipement", Model.Equipement, new { @class = "form-control"})
                }
                else
                {
                    @Model.Equipement
                }
            </p>
        </div>
    </div>
    <div class="col-lg-4" style="height:100%;">
        <div class="well">
            @if(edit)
            {
                <p>Participants :</p>
                <p class="form-group col-lg-6">
                    Minimium :
                    @Html.TextBoxFor(i => i.PeopleMin, new { @type = "number", @class = "form-control" })
                </p>

                <p class="form-group col-lg-6">
                    Maximum :
                    @Html.TextBoxFor(i => i.PeopleMax, new { @type = "number", @class = "form-control" })
                </p>
            }
            else
            {
                <div> 
                    @{
                        int participants = 0;
                        foreach(TiichDAL.User us in Model.Participants)
                        {
                            string imgPath = "/Content/Avatars/" + (us.Avatar == null ? "null.png" : us.Avatar) + ".png";
                            <img src=@imgPath class="roundedImage col-lg-2"/>
                        }

                        for (; participants < Model.PeopleMax; participants++)
                        {
                            <img src="~/Content/Avatars/emptySpace.png" class="roundedImage roundedImage-mini " style="display:inline;margin-top:0px;"/>
                        }
                        
                    }
                </div>
            }

           
            @if(edit)
            {
                <input type="submit" class="btn btn-primary "/>
            }
            else
            {
                
                @Html.ActionLink("Participer", "Participate", new { userID = TempData["UserID"], workshopID = Model.ID }, new { @class = "btn btn-success" })
            }
        </div>

        @if(!edit)
        {
            <div class="well" style="height:100%;">
                <h3>@Model.User.Email</h3>
            
            </div>
        }
    </div>
</div>
}
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places"></script>
<script src="~/Scripts/Gmap.js"></script>
<script type="text/javascript">

    function updateSlideValue(newValue) {
        alert(newValue);
        document.getElementById("range").innerHTML = newValue;
    }
    $(document).ready(function () {
    });
</script>
